generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  // provider = "postgresql"
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Event {
  id            String   @id @default(uuid())
  title         String
  description   String?
  date_start    DateTime
  date_end      DateTime
  time_earliest String   @default("08:00")
  time_latest   String   @default("18:00")
  timezone      String   @default("America/Sao_Paulo")
  url_slug      String   @unique
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  participants Participant[]
  time_slots   TimeSlot[]

  @@index([url_slug])
  @@map("events")
}

model Participant {
  id         String   @id @default(uuid())
  event_id   String
  name       String
  password   String
  role       String   @default("participant")
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  event          Event          @relation(fields: [event_id], references: [id], onDelete: Cascade)
  availabilities Availability[]

  @@unique([event_id, name])
  @@index([event_id])
  @@map("participants")
}

model TimeSlot {
  id         String   @id @default(uuid())
  event_id   String
  start_time DateTime
  end_time   DateTime
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  event          Event          @relation(fields: [event_id], references: [id], onDelete: Cascade)
  availabilities Availability[]

  @@unique([event_id, start_time])
  @@index([event_id])
  @@map("time_slots")
}

model Availability {
  participant_id String
  time_slot_id   String
  status         String
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  participant Participant @relation(fields: [participant_id], references: [id], onDelete: Cascade)
  time_slot   TimeSlot    @relation(fields: [time_slot_id], references: [id], onDelete: Cascade)

  @@id([participant_id, time_slot_id])
  @@index([participant_id])
  @@index([time_slot_id])
  @@map("availabilities")
}
